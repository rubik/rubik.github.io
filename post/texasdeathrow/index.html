<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/static/icons/apple-touch-icon.png><link rel=icon type=image/png href=/static/icons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/static/icons/favicon-16x16.png sizes=16x16><link rel=manifest href=/static/icons/manifest.json><link rel=mask-icon href=/static/icons/safari-pinned-tab.svg color=#2ae2b1><link rel="shortcut icon" href=/static/icons/favicon.ico><meta name=msapplication-config content="/static/icons/browserconfig.xml"><meta name=theme-color content="#ffffff"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400&display=swap" rel=stylesheet><link rel=stylesheet href=https://signal-to-noise.xyz/scss/main.min.6d905468f4703eed3a6be770925feacadfbddf831f38d2d000062749b1b4e74a.css integrity="sha256-bZBUaPRwPu06a+dwkl/qyt+934MfONLQAAYnSbG050o="><script async src=https://rum.cronitor.io/script.js></script>
<script>window.cronitor=window.cronitor||function(){(window.cronitor.q=window.cronitor.q||[]).push(arguments)},cronitor("config",{clientKey:"ab51f29e7df6ffe65a02338fc78976e1"})</script><title>Exploration of Texas death row data</title><meta name=description content="Exploration of Texas death row data"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/signal-to-noise.xyz\/post\/texasdeathrow\/"},"headline":"Exploration of Texas death row data","name":"Exploration of Texas death row data","datePublished":"2016-10-29","dateModified":"20161029-00:00:00.000","author":{"@type":"Person","name":"Michele Lacchia"},"publisher":{"@type":"Organization","name":"Signal to Noise","logo":{"@type":"ImageObject","url":"https:\/\/signal-to-noise.xyz\/static\/images\/signal-to-noise.png"}},"description":"Exploration of Texas death row data","keywords":"python,sklearn,gensim,altair"}</script></head><body><div class=container><header role=banner><div class=header-logo><a href=/><img src=/static/images/signal-to-noise.png width=60 height=60 alt="Signal to Noise"></a></div></header><main role=main><article class=main-content><div class=post-meta><h1>Exploration of Texas death row data</h1><span><time datetime=2016-10-29>October 29, 2016</time>, Michele Lacchia</span></div><div class=post-tags><a href=https://signal-to-noise.xyz//tags/python>python</a>
<a href=https://signal-to-noise.xyz//tags/sklearn>sklearn</a>
<a href=https://signal-to-noise.xyz//tags/gensim>gensim</a>
<a href=https://signal-to-noise.xyz//tags/altair>altair</a></div><p>On the site of the <a href=https://www.tdcj.state.tx.us target=_blank rel="noopener noreferrer">Texas Department of Criminal Justice</a> there&rsquo;s a page which lists all the people that have been executed since 1982, when the death penalty was reinstated, along with their last statement. The data is <a href=https://www.tdcj.state.tx.us/death_row/dr_executed_offenders.html target=_blank rel="noopener noreferrer">here</a>. In this project we are going to explore the data and see if we can apply topic modeling to the statements.</p><h2 id=setup>Setup</h2><p>We are going to use the following packages:</p><ul><li><code>scrapy</code> to scrape the data</li><li><code>numpy</code> and <code>pandas</code> for the data manipulation</li><li><code>altair</code> to create plots, and occasionally <code>matplotlib</code></li><li><code>gmaps</code> to create a heat map over a Google Map</li><li><code>textblob</code> for sentiment analysis</li><li><code>scikit-learn</code> to do topic modeling</li><li><code>gensim</code> for additional topic modeling</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>numpy</span> <span class=k>as</span> <span class=nn>np</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pandas</span> <span class=k>as</span> <span class=nn>pd</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>altair</span> <span class=kn>import</span> <span class=n>Chart</span><span class=p>,</span> <span class=n>X</span><span class=p>,</span> <span class=n>Y</span><span class=p>,</span> <span class=n>Axis</span><span class=p>,</span> <span class=n>Scale</span><span class=p>,</span> <span class=n>Color</span><span class=p>,</span> <span class=n>Bin</span><span class=p>,</span> <span class=n>SortField</span><span class=p>,</span> <span class=n>Column</span><span class=p>,</span> <span class=n>Formula</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Two convenience functions to work with Altair and Matplotlib</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>show</span><span class=p>(</span><span class=o>*</span><span class=n>charts</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>700</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>300</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>chart</span> <span class=ow>in</span> <span class=n>charts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>chart</span><span class=o>.</span><span class=n>configure_cell</span><span class=p>(</span><span class=n>width</span><span class=o>=</span><span class=n>width</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=n>height</span><span class=p>)</span><span class=o>.</span><span class=n>display</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>pie</span><span class=p>(</span><span class=n>ax</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>patches</span><span class=p>,</span> <span class=n>_</span><span class=p>,</span> <span class=n>_</span> <span class=o>=</span> <span class=n>ax</span><span class=o>.</span><span class=n>pie</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>args</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>colors</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;#BEE9E8&#39;</span><span class=p>,</span> <span class=s1>&#39;#62B6CB&#39;</span><span class=p>,</span> <span class=s1>&#39;#5FA8D3&#39;</span><span class=p>,</span> <span class=s1>&#39;#DCEDEC&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>autopct</span><span class=o>=</span><span class=s1>&#39;</span><span class=si>%1.1f%%</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>kwargs</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>patches</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span><span class=o>.</span><span class=n>set_linewidth</span><span class=p>(</span><span class=mf>0.6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;equal&#39;</span><span class=p>)</span>
</span></span></code></pre></div><h2 id=scraping-the-data>Scraping the data</h2><p>I used <a href=https://scrapy.org/ target=_blank rel="noopener noreferrer">Scrapy</a> to obtain all the data. In the first iteration of this project I was using <code>requests</code> and <code>BeautifulSoup</code>. However, the code quickly became messy and even though I was using <code>concurrent.futures</code> to send asynchronous requests it was unbearably slow. Hence my decision to switch to Scrapy. I had already used it, and it&rsquo;s really easy to setup. I won&rsquo;t post the complete code here, because Scrapy requires a whole project to run. The important part is the spider, which is contained in a single class. If you&rsquo;ve already used Scrapy, the code is very easy to follow, with minor adjustments for errors in the original page (see people #416 and #419 for an example).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>TexasDeathSpider</span><span class=p>(</span><span class=n>scrapy</span><span class=o>.</span><span class=n>Spider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;texas_death&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>allowed_domains</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;www.tdcj.state.tx.us&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>start_urls</span> <span class=o>=</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;https://www.tdcj.state.tx.us/death_row/dr_executed_offenders.html&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>_</span><span class=p>,</span> <span class=o>*</span><span class=n>rows</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;table tr&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>fields</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;execution&#39;</span><span class=p>,</span> <span class=s1>&#39;last_name&#39;</span><span class=p>,</span> <span class=s1>&#39;first_name&#39;</span><span class=p>,</span> <span class=s1>&#39;tdcj_number&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                  <span class=s1>&#39;age_execution&#39;</span><span class=p>,</span> <span class=s1>&#39;date_execution&#39;</span><span class=p>,</span> <span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;county&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>item</span> <span class=o>=</span> <span class=n>PersonItem</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>values</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;td::text&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>values</span><span class=p>)</span> <span class=o>&gt;</span> <span class=nb>len</span><span class=p>(</span><span class=n>fields</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=c1># Special cases: people #416 and #419</span>
</span></span><span class=line><span class=cl>                <span class=k>del</span> <span class=n>values</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>field</span><span class=p>,</span> <span class=n>value</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>fields</span><span class=p>,</span> <span class=n>values</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>item</span><span class=p>[</span><span class=n>field</span><span class=p>]</span> <span class=o>=</span> <span class=n>value</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>info</span><span class=p>,</span> <span class=n>last_stmt</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;td &gt; a::attr(href)&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>no_info</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>endswith</span><span class=p>((</span><span class=s1>&#39;.jpg&#39;</span><span class=p>,</span> <span class=s1>&#39;no_info_available.html&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>no_stmt</span> <span class=o>=</span> <span class=n>last_stmt</span><span class=o>.</span><span class=n>endswith</span><span class=p>(</span><span class=s1>&#39;no_last_statement.html&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>no_info</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>item</span><span class=p>[</span><span class=s1>&#39;gender&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>                <span class=n>info</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>no_stmt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>item</span><span class=p>[</span><span class=s1>&#39;last_statement&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>no_info</span> <span class=ow>and</span> <span class=n>no_stmt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>no_stmt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>urljoin</span><span class=p>(</span><span class=n>info</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                     <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse_gender</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;item&#39;</span><span class=p>:</span> <span class=n>item</span><span class=p>})</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>info_url</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>urljoin</span><span class=p>(</span><span class=n>info</span><span class=p>)</span> <span class=k>if</span> <span class=n>info</span> <span class=k>else</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>                <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>urljoin</span><span class=p>(</span><span class=n>last_stmt</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                                     <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse_last_stmt</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                     <span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;item&#39;</span><span class=p>:</span> <span class=n>item</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                           <span class=s1>&#39;info_url&#39;</span><span class=p>:</span> <span class=n>info_url</span><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse_last_stmt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;item&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>info_url</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;info_url&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>ps</span> <span class=o>=</span> <span class=p>[</span><span class=n>p</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>p</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;p::text&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=n>p</span><span class=o>.</span><span class=n>strip</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span><span class=p>[</span><span class=s1>&#39;last_statement&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ps</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>info_url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>yield</span> <span class=n>item</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Request</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>info_url</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>callback</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>parse_gender</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>meta</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;item&#39;</span><span class=p>:</span> <span class=n>item</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse_gender</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>meta</span><span class=p>[</span><span class=s1>&#39;item&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;table tr&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>item</span><span class=p>[</span><span class=s1>&#39;gender&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>rows</span><span class=p>[</span><span class=mi>10</span><span class=p>]</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;td::text&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract</span><span class=p>()[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>yield</span> <span class=n>item</span>
</span></span></code></pre></div><p>The crawler is really fast compared to the previous approach and with Scrapy exporting the data to other formats is relatively painless. I saved all the data in the file <code>texas_death_itmes.csv</code>.
If you read the spider code you&rsquo;ll have noticed that there are a few special cases. In some cases, there is no additional information. In others the additional information is not in an HTML page but in an image of a scanned document.</p><p>Unfortunately many times the additional information is missing and we are served an image instead: I tried to read the text in them with <code>pyocr</code> and <code>tesseract</code>, but I had terrible results. The images are not at all uniform, and in many cases there are spots on the document which confuse the OCR engine. It could make for a challenging project, but since at the moment our goal is different, I decided to abandon the idea and focus on the statements and the available data.</p><p>The additional information is rarely present, leaving us with only 151 people with additional information out of 538. I decided to extract only the gender from the additional information, as it&rsquo;s relatively easy to guess it for the missing people.</p><h2 id=cleaning-and-processing-the-data>Cleaning and processing the data</h2><p>We&rsquo;ll now clean the data we have to see if there&rsquo;s anything interesting in it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>read_csv</span><span class=p>(</span><span class=s1>&#39;texas_death_items.csv&#39;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>info</span><span class=p>()</span>
</span></span></code></pre></div><pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 538 entries, 0 to 537
Data columns (total 10 columns):
execution         538 non-null int64
last_name         538 non-null object
first_name        538 non-null object
tdcj_number       538 non-null int64
gender            151 non-null object
race              538 non-null object
age_execution     538 non-null int64
date_execution    538 non-null object
county            538 non-null object
last_statement    436 non-null object
dtypes: int64(3), object(7)
memory usage: 42.1+ KB
</code></pre><p>We see that we are only missing the gender and about a hundred statements, from the people who declined to make one.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></div><div><table><thead><tr style=text-align:right><th></th><th>execution</th><th>last_name</th><th>first_name</th><th>tdcj_number</th><th>gender</th><th>race</th><th>age_execution</th><th>date_execution</th><th>county</th><th>last_statement</th></tr></thead><tbody><tr><th>0</th><td>460</td><td>Powell</td><td>David</td><td>612</td><td>NaN</td><td>White</td><td>59</td><td>06/15/2010</td><td>Travis</td><td>NaN</td></tr><tr><th>1</th><td>418</td><td>Nenno</td><td>Eric</td><td>999188</td><td>NaN</td><td>White</td><td>45</td><td>10/28/2008</td><td>Harris</td><td>NaN</td></tr><tr><th>2</th><td>408</td><td>Sonnier</td><td>Derrick</td><td>999054</td><td>NaN</td><td>Black</td><td>40</td><td>07/23/2008</td><td>Harris</td><td>NaN</td></tr><tr><th>3</th><td>394</td><td>Griffith</td><td>Michael</td><td>999176</td><td>NaN</td><td>White</td><td>56</td><td>06/06/2007</td><td>Harris</td><td>NaN</td></tr><tr><th>4</th><td>393</td><td>Smith</td><td>Charles</td><td>953</td><td>NaN</td><td>White</td><td>41</td><td>05/16/2007</td><td>Pecos</td><td>NaN</td></tr></tbody></table></div><p>Let&rsquo;s start by processing the dates.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>date_execution</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=nb>len</span><span class=p>)</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span>
</span></span></code></pre></div><pre><code>10    536
9       2
Name: date_execution, dtype: int64
</code></pre><p>The two dates which are nine characters long could be malformed, let&rsquo;s check.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>date_execution</span><span class=p>[</span><span class=n>people</span><span class=o>.</span><span class=n>date_execution</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=nb>len</span><span class=p>)</span> <span class=o>==</span> <span class=mi>9</span><span class=p>]</span>
</span></span></code></pre></div><pre><code>425    11/6/2008
536    10/6/2015
Name: date_execution, dtype: object
</code></pre><p>It turns out they aren&rsquo;t malformed, so we can process them in bulk.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>_read_date</span><span class=p>(</span><span class=n>date</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>strptime</span><span class=p>(</span><span class=n>date</span><span class=p>,</span> <span class=s1>&#39;%m/</span><span class=si>%d</span><span class=s1>/%Y&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>date_execution</span> <span class=o>=</span> <span class=n>people</span><span class=o>.</span><span class=n>date_execution</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>_read_date</span><span class=p>)</span>
</span></span></code></pre></div><p>The gender column is a bit more complicated to fill, since in theory there are a few names that are considered &lsquo;unisex&rsquo; (<s>babynameguide.com has a comprehensive list</s> UPDATE (2022): the site is no longer operational). Let&rsquo;s check the names of the people for which we are missing the gender.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>gender</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;male&#39;</span><span class=p>,</span> <span class=s1>&#39;Male&#39;</span><span class=p>,</span> <span class=n>inplace</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>known_names</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>people</span><span class=p>[[</span><span class=s1>&#39;first_name&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>names</span> <span class=o>=</span> <span class=n>people</span><span class=o>.</span><span class=n>first_name</span><span class=p>[</span><span class=n>people</span><span class=p>[[</span><span class=s1>&#39;first_name&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>isnull</span><span class=p>()</span><span class=o>.</span><span class=n>any</span><span class=p>(</span><span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=nb>len</span><span class=p>(</span><span class=n>names</span><span class=o>.</span><span class=n>unique</span><span class=p>()),</span> <span class=nb>len</span><span class=p>(</span><span class=n>names</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>(204, 387)
</code></pre><p>First of all, we&rsquo;ll use the information we already have to infer the gender of the other people:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>known_names</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>people</span><span class=p>[[</span><span class=s1>&#39;first_name&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span><span class=o>.</span><span class=n>values</span><span class=p>)</span>
</span></span></code></pre></div><p>For the remaining names we&rsquo;ll use the package <code>SexMachine</code>. Note that it does not work on Python 3, and I had to manually change a couple of lines of code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sexmachine.detector</span> <span class=kn>import</span> <span class=n>Detector</span>
</span></span><span class=line><span class=cl><span class=n>d</span> <span class=o>=</span> <span class=n>Detector</span><span class=p>()</span>
</span></span></code></pre></div><p>The detector returns <code>mostly_{gender}</code> when it&rsquo;s not sure. Since almost the totality of executed people are male, in our case we can safely interpret <code>mostly_male</code> as <code>male</code>. We have to manually check the rest. (Note: here <code>andy</code> means androgynous, i.e. what I called &lsquo;unisex&rsquo; name before.)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>remaining</span> <span class=o>=</span> <span class=nb>set</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>names</span><span class=o>.</span><span class=n>unique</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>gender</span> <span class=o>=</span> <span class=n>d</span><span class=o>.</span><span class=n>get_gender</span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;_&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>gender</span> <span class=o>==</span> <span class=s1>&#39;male&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>known_names</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Male&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span>
</span></span><span class=line><span class=cl>    <span class=n>remaining</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>{}</span><span class=s1> -&gt; </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>gender</span><span class=p>))</span>
</span></span></code></pre></div><pre><code>Marion -&gt; female
Jessie -&gt; female
Caruthers -&gt; andy
Ponchai -&gt; andy
Betty -&gt; female
Clydell -&gt; andy
Excell -&gt; andy
Lesley -&gt; andy
Esequel -&gt; andy
Kavin -&gt; andy
G.W. -&gt; andy
Markum -&gt; andy
Denton -&gt; andy
Hai -&gt; andy
Dorsie -&gt; andy
Irineo -&gt; andy
Jessel -&gt; andy
Aua -&gt; andy
Karla -&gt; female
Sammie -&gt; andy
Orien -&gt; andy
Stacey -&gt; female
Jermarr -&gt; andy
Ronford -&gt; andy
T.J. -&gt; andy
Toronto -&gt; andy
Alva -&gt; andy
Kia -&gt; female
Kelsey -&gt; female
Dominique -&gt; andy
Shannon -&gt; andy
Jaime -&gt; andy
Jackie -&gt; andy
Mauriceo -&gt; andy
Farley -&gt; andy
Lionell -&gt; andy
Daroyce -&gt; andy
Elkie -&gt; andy
Jamie -&gt; female
</code></pre><p>I checked each one by hand on the TDCJ page, and as expected they&rsquo;re all male except two: <code>Betty</code> and <code>Karla</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>remaining</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>known_names</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Male&#39;</span>
</span></span><span class=line><span class=cl><span class=n>known_names</span><span class=p>[</span><span class=s1>&#39;Betty&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Female&#39;</span>
</span></span><span class=line><span class=cl><span class=n>known_names</span><span class=p>[</span><span class=s1>&#39;Karla&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;Female&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>gender</span> <span class=o>=</span> <span class=n>people</span><span class=o>.</span><span class=n>apply</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=k>lambda</span> <span class=n>row</span><span class=p>:</span> <span class=n>known_names</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>row</span><span class=o>.</span><span class=n>first_name</span><span class=p>,</span> <span class=n>row</span><span class=o>.</span><span class=n>gender</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>axis</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>gender</span><span class=o>.</span><span class=n>value_counts</span><span class=p>(</span><span class=n>dropna</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>Male      533
Female      5
Name: gender, dtype: int64
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=o>.</span><span class=n>info</span><span class=p>()</span>
</span></span></code></pre></div><pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 538 entries, 0 to 537
Data columns (total 10 columns):
execution         538 non-null int64
last_name         538 non-null object
first_name        538 non-null object
tdcj_number       538 non-null int64
gender            538 non-null object
race              538 non-null object
age_execution     538 non-null int64
date_execution    538 non-null datetime64[ns]
county            538 non-null object
last_statement    436 non-null object
dtypes: datetime64[ns](1), int64(3), object(6)
memory usage: 42.1+ KB
</code></pre><h2 id=data-visualization>Data visualization</h2><p>We&rsquo;ll first observe the general characteristics of the dataset by visualizing the most important ones.</p><h3 id=distribution-of-race-age-and-sex>Distribution of race, age and sex</h3><p>Let&rsquo;s start by plotting the race distribution as a pie chart.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>race_counts</span> <span class=o>=</span> <span class=n>people</span><span class=p>[</span><span class=s1>&#39;race&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>value_counts</span><span class=p>()</span><span class=o>.</span><span class=n>reset_index</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>race_counts</span><span class=o>.</span><span class=n>columns</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;count&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>pop</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;race&#39;</span><span class=p>:</span> <span class=p>[</span><span class=s1>&#39;White&#39;</span><span class=p>,</span> <span class=s1>&#39;Black&#39;</span><span class=p>,</span> <span class=s1>&#39;Hispanic&#39;</span><span class=p>,</span> <span class=s1>&#39;Other&#39;</span><span class=p>],</span> <span class=s1>&#39;count&#39;</span><span class=p>:</span> <span class=p>[</span><span class=mi>196817552</span><span class=p>,</span> <span class=mi>37685848</span><span class=p>,</span> <span class=mi>50477594</span><span class=p>,</span> <span class=mi>23764544</span><span class=p>]})</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=p>(</span><span class=n>ax1</span><span class=p>,</span> <span class=n>ax2</span><span class=p>)</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>ncols</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>10</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>pie</span><span class=p>(</span><span class=n>ax1</span><span class=p>,</span> <span class=n>race_counts</span><span class=p>[</span><span class=s1>&#39;count&#39;</span><span class=p>],</span> <span class=n>labels</span><span class=o>=</span><span class=n>race_counts</span><span class=p>[</span><span class=s1>&#39;race&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>pie</span><span class=p>(</span><span class=n>ax2</span><span class=p>,</span> <span class=n>pop</span><span class=p>[</span><span class=s1>&#39;count&#39;</span><span class=p>],</span> <span class=n>labels</span><span class=o>=</span><span class=n>pop</span><span class=p>[</span><span class=s1>&#39;race&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>ax1</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Race distribution among executed people&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>ax2</span><span class=o>.</span><span class=n>set_title</span><span class=p>(</span><span class=s1>&#39;Race distribution among U.S. population (2010)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>subplots_adjust</span><span class=p>(</span><span class=n>wspace</span><span class=o>=</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>(</span><span class=n>fig</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=/TexasDeathRow_files/TexasDeathRow_32_0.png alt=png></p><p>The population data was taken from the <a href=https://www.census.gov/prod/cen2010/briefs/c2010br-02.pdf target=_blank rel="noopener noreferrer">2010 US Census</a> (PDF). It&rsquo;s pretty clear that White people are underrepresented in the death row data, while Black people are considerably overrepresented. People of Hispanic descent are roughly proportional. Although it would be very interesting to investigate into the causes of this disproportion, we have too little data and our main goal is to analyze the statements, so we will not venture further.</p><p>Let&rsquo;s visualize the age with respect to race.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=n>Chart</span><span class=p>(</span><span class=n>people</span><span class=p>[[</span><span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;age_execution&#39;</span><span class=p>]])</span><span class=o>.</span><span class=n>mark_bar</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>column</span><span class=o>=</span><span class=n>Column</span><span class=p>(</span><span class=s1>&#39;age_execution&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                      <span class=nb>bin</span><span class=o>=</span><span class=n>Bin</span><span class=p>(</span><span class=n>maxbins</span><span class=o>=</span><span class=mi>10</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=n>X</span><span class=p>(</span><span class=s1>&#39;race&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>axis</span><span class=o>=</span><span class=n>Axis</span><span class=p>(</span><span class=n>labels</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>tickSize</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>titleFontSize</span><span class=o>=</span><span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>scale</span><span class=o>=</span><span class=n>Scale</span><span class=p>(</span><span class=n>bandSize</span><span class=o>=</span><span class=mi>10</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=</span><span class=s1>&#39;count(*)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=s1>&#39;race&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span><span class=o>.</span><span class=n>configure_facet_cell</span><span class=p>(</span><span class=n>strokeWidth</span><span class=o>=</span><span class=mi>0</span><span class=p>))</span>
</span></span></code></pre></div><div class=vega-embed id=ee8d68e8-06d9-48b9-8be5-8233ebfe95ff></div><style>.vega-embed svg,.vega-embed canvas{border:1px dotted gray}.vega-embed .vega-actions a{margin-right:6px}</style><p><img src=/TexasDeathRow_files/TexasDeathRow_35_2.png alt=png></p><p>It&rsquo;s very interesting to note that black people are generally younger than white people at the time of the execution. We could think that white people tend to commit violent crimes at an older age, compared with the crimes committed by black people. However, we have to remember that the age in the chart is the age at the time of execution, not the age at the time of the crime. Many inmates sit on the death row for quite a long time. The Texas Department of Criminal Justice has <a href=https://www.tdcj.state.tx.us/death_row/dr_facts.html target=_blank rel="noopener noreferrer">a page</a> with some statistics. We see that the average time on death row prior to execution is almost <code>11</code> years. The page doesn&rsquo;t provide the variance in the data, but lists the more extreme cases: <code>252</code> days is the shortest time, while <code>11 575</code> days (that is, <code>31</code> years) is the longest time recorded.</p><p>Also interesting is the distribution of gender:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=n>Chart</span><span class=p>(</span><span class=n>people</span><span class=p>[[</span><span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;gender&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>dropna</span><span class=p>())</span><span class=o>.</span><span class=n>mark_bar</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=s1>&#39;count(*)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=</span><span class=n>Y</span><span class=p>(</span><span class=s1>&#39;race&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>sort</span><span class=o>=</span><span class=n>SortField</span><span class=p>(</span><span class=s1>&#39;count(*)&#39;</span><span class=p>,</span> <span class=n>op</span><span class=o>=</span><span class=s1>&#39;mean&#39;</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=s1>&#39;descending&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=s1>&#39;gender&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span> <span class=n>width</span><span class=o>=</span><span class=mi>600</span><span class=p>)</span>
</span></span></code></pre></div><div class=vega-embed id=e40a9335-7c99-47cd-a135-d0fe6f744354></div><style>.vega-embed svg,.vega-embed canvas{border:1px dotted gray}.vega-embed .vega-actions a{margin-right:6px}</style><p><img src=/TexasDeathRow_files/TexasDeathRow_38_2.png alt=png></p><p>Not surprisingly, the overwhelming majority of executed offenders is male. That is because under <a href=https://en.wikipedia.org/wiki/Capital_punishment_in_Texas#Capital_offenses target=_blank rel="noopener noreferrer">Texas statutes</a> death penalty is generally sought for murders, and men are more likely to commit a violent crime (data from <a href=https://www.bjs.gov/content/pub/pdf/cvus0702.pdf target=_blank rel="noopener noreferrer">this survey</a> (PDF) from the U.S. department of Justice, table 38). As to why is it so, it is still debated. <a href=https://en.wikipedia.org/wiki/Sex_differences_in_crime#Aggression_and_violence_among_peers_and_in_relationships target=_blank rel="noopener noreferrer">Wikipedia</a> enumerates some of the current theories, with references if you desire to read further. An interesting quote from the linked paragraph is reported here:</p><blockquote><p>Another 2011 review published in the journal of Aggression and Violent Behavior also found that although minor domestic violence was equal, more severe violence was perpetrated by men.</p></blockquote><h3 id=statement-length>Statement length</h3><p>We&rsquo;ll count the number of sentences in each statement. We&rsquo;ll make use of the amazing package <code>textblob</code>, which has a better API than <code>nltk</code> but uses it behind the scenes. We store the blobs because we&rsquo;ll need them later as well.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>textblob</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>statements</span> <span class=o>=</span> <span class=n>people</span><span class=o>.</span><span class=n>last_statement</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>blobs</span> <span class=o>=</span> <span class=n>statements</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>s</span><span class=p>:</span> <span class=n>textblob</span><span class=o>.</span><span class=n>TextBlob</span><span class=p>(</span><span class=n>s</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>n_sentences</span> <span class=o>=</span> <span class=n>blobs</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>b</span><span class=p>:</span> <span class=nb>len</span><span class=p>(</span><span class=n>b</span><span class=o>.</span><span class=n>sentences</span><span class=p>))</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=n>Chart</span><span class=p>(</span><span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>({</span><span class=s1>&#39;Number of sentences&#39;</span><span class=p>:</span> <span class=n>n_sentences</span><span class=p>}))</span><span class=o>.</span><span class=n>mark_bar</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=s1>&#39;Number of sentences:N&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=</span><span class=s1>&#39;count(*)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>))</span>
</span></span></code></pre></div><div class=vega-embed id=befce099-a95c-4087-97f7-623fe66b1f73></div><style>.vega-embed svg,.vega-embed canvas{border:1px dotted gray}.vega-embed .vega-actions a{margin-right:6px}</style><p><img src=/TexasDeathRow_files/TexasDeathRow_42_2.png alt=png></p><p>The distribution of the number of sentences is skewed to the left, favoring shorter statements. There&rsquo;s one statement that separates itself from the rest: it is much longer than all the others, at 138 sentences. Out of curiosity, let&rsquo;s investigate a bit:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>len</span><span class=p>(</span><span class=n>blobs</span><span class=p>[</span><span class=n>n_sentences</span><span class=o>.</span><span class=n>argmax</span><span class=p>()]</span><span class=o>.</span><span class=n>words</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>1294
</code></pre><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=p>[[</span><span class=s1>&#39;last_name&#39;</span><span class=p>,</span> <span class=s1>&#39;first_name&#39;</span><span class=p>,</span> <span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;date_execution&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>ix</span><span class=p>[</span><span class=n>n_sentences</span><span class=o>.</span><span class=n>argmax</span><span class=p>()]</span>
</span></span></code></pre></div><pre><code>last_name                      Graham
first_name                       Gary
race                            Black
date_execution    2000-06-22 00:00:00
Name: 258, dtype: object
</code></pre><p>The statement is from Shaka Sankofa, a.k.a. Gary Graham, who was found guilty in a controversial process in the nineties. His supporters brought his case to international attention. Here are the first words of his statement:</p><blockquote><p>I would like to say that I did not kill Bobby Lambert. That I&rsquo;m an innocent black man that is being murdered. This is a lynching that is happening in America tonight. There&rsquo;s overwhelming and compelling evidence of my defense that has never been heard in any court of America. What is happening here is an outrage for any civilized country to anybody anywhere to look at what&rsquo;s happening here is wrong. I thank all of the people that have rallied to my cause. They&rsquo;ve been standing in support of me. Who have finished with me. I say to Mr. Lambert&rsquo;s family, I did not kill Bobby Lambert. You are pursuing the execution of an innocent man. I want to express my sincere thanks to all of ya&rsquo;ll. We must continue to move forward and do everything we can to outlaw legal lynching in America.</p></blockquote><p>Although he denied committing the murder until his very end, he admitted that at the time of Lambert&rsquo;s death he was on a week-long spree of armed robberies, assaults, attempted murders and one rape. Wikipedia has a <a href=https://en.wikipedia.org/wiki/Shaka_Sankofa target=_blank rel="noopener noreferrer">page</a> on him if you wish to read more.</p><h3 id=number-of-executions-per-year>Number of executions per year</h3><p>For this one, a line chart is a better fit.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people</span><span class=p>[</span><span class=s1>&#39;year_execution&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>people</span><span class=o>.</span><span class=n>date_execution</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>d</span><span class=p>:</span> <span class=n>d</span><span class=o>.</span><span class=n>year</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=n>Chart</span><span class=p>(</span><span class=n>people</span><span class=p>)</span><span class=o>.</span><span class=n>mark_line</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=n>X</span><span class=p>(</span><span class=s1>&#39;year_execution&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>axis</span><span class=o>=</span><span class=n>Axis</span><span class=p>(</span><span class=nb>format</span><span class=o>=</span><span class=s1>&#39;f&#39;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>scale</span><span class=o>=</span><span class=n>Scale</span><span class=p>(</span><span class=n>zero</span><span class=o>=</span><span class=kc>False</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=</span><span class=s1>&#39;count(*)&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>))</span>
</span></span></code></pre></div><div class=vega-embed id=b4d1d94e-cf5d-47a3-b1fa-75296c9dc3ca></div><style>.vega-embed svg,.vega-embed canvas{border:1px dotted gray}.vega-embed .vega-actions a{margin-right:6px}</style><p><img src=/TexasDeathRow_files/TexasDeathRow_48_2.png alt=png></p><p>It looks like executions peaked in year 2000 at 40. That&rsquo;s quite a lot: about one every 9 days. Year 2000 has been called <a href=https://www.deathpenaltyinfo.org/2000-year-end-report-watershed-year-change target=_blank rel="noopener noreferrer">&lsquo;A Watershed Year of Change&rsquo;</a>, because numerous exonerations revealed persistent errors in the administration of capital punishment and increased public awareness. Many capital punishment advocates changed their mind and joined the growing movement that called for reforms and ultimately the abolishment of death penalty. This also serves as a good explanation for the downward trend that follows year 2000.</p><h3 id=crimes-map>Crimes map</h3><p>We&rsquo;ll make a heat map of the counties where the crimes were committed, and for that we&rsquo;ll need the geographic centre of each county. I found an extremely useful table curated by the Wikipedia user Michael J, which among a wealth of other data also has coordinates for each county. The table is available <a href=https://en.wikipedia.org/wiki/User:Michael_J/County_table target=_blank rel="noopener noreferrer">here</a>.</p><p>Since there are no links to follow, a whole Scrapy spider is redundant, but we&rsquo;ll use the convenient Scrapy selector.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>scrapy</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>counties</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>body</span> <span class=o>=</span> <span class=n>scrapy</span><span class=o>.</span><span class=n>Selector</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>text</span><span class=o>=</span><span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;https://en.wikipedia.org/wiki/User:Michael_J/County_table&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>_</span><span class=p>,</span> <span class=o>*</span><span class=n>rows</span> <span class=o>=</span> <span class=n>body</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;table tr&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>cols</span> <span class=o>=</span> <span class=n>row</span><span class=o>.</span><span class=n>css</span><span class=p>(</span><span class=s1>&#39;td ::text&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>extract</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>cols</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;TX&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>lat</span><span class=p>,</span> <span class=n>long</span> <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>i</span><span class=p>:</span> <span class=n>i</span><span class=o>.</span><span class=n>strip</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\u2013</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>),</span> <span class=n>cols</span><span class=p>[</span><span class=o>-</span><span class=mi>2</span><span class=p>:])</span>
</span></span><span class=line><span class=cl>        <span class=n>counties</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>cols</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span> <span class=n>lat</span><span class=p>,</span> <span class=n>long</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>counties</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>counties</span><span class=p>,</span> <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;county&#39;</span><span class=p>,</span> <span class=s1>&#39;lat&#39;</span><span class=p>,</span> <span class=s1>&#39;lon&#39;</span><span class=p>])</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>counties</span><span class=o>.</span><span class=n>lat</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>counties</span><span class=o>.</span><span class=n>lat</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>counties</span><span class=o>.</span><span class=n>lon</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>to_numeric</span><span class=p>(</span><span class=n>counties</span><span class=o>.</span><span class=n>lon</span><span class=p>)</span>
</span></span></code></pre></div><p>Now we have the coordinates of each county:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>counties</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></div><div><table><thead><tr style=text-align:right><th></th><th>county</th><th>lat</th><th>lon</th></tr></thead><tbody><tr><th>0</th><td>Anderson</td><td>31.841266</td><td>-95.661744</td></tr><tr><th>1</th><td>Andrews</td><td>32.312258</td><td>-102.640206</td></tr><tr><th>2</th><td>Angelina</td><td>31.251951</td><td>-94.611056</td></tr><tr><th>3</th><td>Aransas</td><td>28.104225</td><td>-96.977983</td></tr><tr><th>4</th><td>Archer</td><td>33.616305</td><td>-98.687267</td></tr></tbody></table></div><p>We just have to group our data with respect to the county,</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>county_count</span> <span class=o>=</span> <span class=n>people</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>people</span><span class=o>.</span><span class=n>county</span><span class=p>)</span><span class=o>.</span><span class=n>size</span><span class=p>()</span><span class=o>.</span><span class=n>reset_index</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s1>&#39;count&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>county_count</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></div><div><table><thead><tr style=text-align:right><th></th><th>county</th><th>count</th></tr></thead><tbody><tr><th>0</th><td>Anderson</td><td>4</td></tr><tr><th>1</th><td>Aransas</td><td>1</td></tr><tr><th>2</th><td>Atascosa</td><td>1</td></tr><tr><th>3</th><td>Bailey</td><td>1</td></tr><tr><th>4</th><td>Bastrop</td><td>1</td></tr></tbody></table></div><p>and merge the two dataframes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>county_data</span> <span class=o>=</span> <span class=n>county_count</span><span class=o>.</span><span class=n>merge</span><span class=p>(</span><span class=n>counties</span><span class=p>,</span> <span class=n>on</span><span class=o>=</span><span class=s1>&#39;county&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>county_data</span><span class=o>.</span><span class=n>head</span><span class=p>()</span>
</span></span></code></pre></div><div><table><thead><tr style=text-align:right><th></th><th>county</th><th>count</th><th>lat</th><th>lon</th></tr></thead><tbody><tr><th>0</th><td>Anderson</td><td>4</td><td>31.841266</td><td>-95.661744</td></tr><tr><th>1</th><td>Aransas</td><td>1</td><td>28.104225</td><td>-96.977983</td></tr><tr><th>2</th><td>Atascosa</td><td>1</td><td>28.894296</td><td>-98.528187</td></tr><tr><th>3</th><td>Bailey</td><td>1</td><td>34.067521</td><td>-102.830345</td></tr><tr><th>4</th><td>Bastrop</td><td>1</td><td>30.103128</td><td>-97.311859</td></tr></tbody></table></div><p>The heat map is drawn as a layer over a Google Map. In a Jupyter notebook this is rendered as an interactive map. Unfortunately, in the exported notebook the map is only an image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmaps</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gmaps</span><span class=o>.</span><span class=n>configure</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;GMAPS_API_KEY&#39;</span><span class=p>])</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=n>gmaps</span><span class=o>.</span><span class=n>Map</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>county_data</span><span class=p>[[</span><span class=s1>&#39;lat&#39;</span><span class=p>,</span> <span class=s1>&#39;lon&#39;</span><span class=p>,</span> <span class=s1>&#39;count&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>values</span><span class=o>.</span><span class=n>tolist</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>heatmap</span> <span class=o>=</span> <span class=n>gmaps</span><span class=o>.</span><span class=n>WeightedHeatmap</span><span class=p>(</span><span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>point_radius</span><span class=o>=</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span><span class=o>.</span><span class=n>add_layer</span><span class=p>(</span><span class=n>heatmap</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>m</span>
</span></span></code></pre></div><img src=/TexasDeathRow_files/heatmap.png style=width:100%><p>It&rsquo;s evident that violent crimes leading to death penalties peak in the largest cities. Comparing this data with the population in Texas, only Austin appears to be an exception It&rsquo;s the fourth largest city in Texas according to <a href=https://en.wikipedia.org/wiki/List_of_cities_in_Texas_by_population target=_blank rel="noopener noreferrer">this table</a>, but its county, Travis, isn&rsquo;t even in the top ten:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>county_count</span><span class=o>.</span><span class=n>sort_values</span><span class=p>(</span><span class=n>by</span><span class=o>=</span><span class=s1>&#39;count&#39;</span><span class=p>,</span> <span class=n>ascending</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=mi>10</span><span class=p>)</span>
</span></span></code></pre></div><div><table><thead><tr style=text-align:right><th></th><th>county</th><th>count</th></tr></thead><tbody><tr><th>35</th><td>Harris</td><td>126</td></tr><tr><th>21</th><td>Dallas</td><td>55</td></tr><tr><th>7</th><td>Bexar</td><td>42</td></tr><tr><th>78</th><td>Tarrant</td><td>38</td></tr><tr><th>64</th><td>Nueces</td><td>16</td></tr><tr><th>42</th><td>Jefferson</td><td>15</td></tr><tr><th>59</th><td>Montgomery</td><td>15</td></tr><tr><th>54</th><td>Lubbock</td><td>12</td></tr><tr><th>10</th><td>Brazos</td><td>12</td></tr><tr><th>77</th><td>Smith</td><td>12</td></tr></tbody></table></div><h2 id=data-analysis>Data analysis</h2><p>We finally get to the analysis of the statements, which will be divided in three parts. First we will conduct a very simple frequency analysis, then we will perform some sentiment analysis on the text. Finally we will attempt to organize the statements in clusters.</p><h3 id=frequency-analysis>Frequency analysis</h3><p>The statements contain some non-ASCII characters, which we will replace for easier processing. There is also spurious text in the form of <code>(Spanish)</code>, <code>(English)</code>, which is added to specify the language in which the statement was spoken.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;statements.txt&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fobj</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>all_text</span> <span class=o>=</span> <span class=n>fobj</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>OSError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>to_replace</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;</span><span class=se>\xa0</span><span class=s1>&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;&#39;</span><span class=p>:</span> <span class=s1>&#39;</span><span class=se>\&#39;</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;&#39;</span><span class=p>:</span> <span class=s1>&#39;</span><span class=se>\&#39;</span><span class=s1>&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;&#39;</span><span class=p>:</span> <span class=s1>&#39;&#34;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;&#39;</span><span class=p>:</span> <span class=s1>&#39;&#34;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;</span><span class=se>\u2013</span><span class=s1>&#39;</span><span class=p>:</span> <span class=s1>&#39;-&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;</span><span class=se>\u2026</span><span class=s1>&#39;</span><span class=p>:</span> <span class=s1>&#39;...&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;(Spanish)&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;(English)&#39;</span><span class=p>:</span> <span class=s1>&#39;&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>all_text</span> <span class=o>=</span> <span class=n>statements</span><span class=o>.</span><span class=n>str</span><span class=o>.</span><span class=n>cat</span><span class=p>(</span><span class=n>sep</span><span class=o>=</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>to_replace</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>all_text</span> <span class=o>=</span> <span class=n>all_text</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;statements.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>fobj</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>fobj</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>all_text</span><span class=p>)</span>
</span></span></code></pre></div><p>The first thing we&rsquo;ll do is use the amazing package <code>wordcloud</code> to generate a pretty visualization of the most used words. We&rsquo;ll also keep the words processed by <code>wordcloud</code> for later use. The packages conveniently processes the text for us, by lowercasing the text, splitting the words and removing the punctuation.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>wordcloud</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>scipy.misc</span> <span class=kn>import</span> <span class=n>imread</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>colors</span> <span class=o>=</span> <span class=n>wordcloud</span><span class=o>.</span><span class=n>ImageColorGenerator</span><span class=p>(</span><span class=n>imread</span><span class=p>(</span><span class=s1>&#39;colors.png&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>wc</span> <span class=o>=</span> <span class=n>wordcloud</span><span class=o>.</span><span class=n>WordCloud</span><span class=p>(</span><span class=n>background_color</span><span class=o>=</span><span class=s1>&#39;white&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>scale</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>max_words</span><span class=o>=</span><span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>relative_scaling</span><span class=o>=</span><span class=mf>0.6</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>words</span> <span class=o>=</span> <span class=n>wc</span><span class=o>.</span><span class=n>process_text</span><span class=p>(</span><span class=n>all_text</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>wc</span><span class=o>.</span><span class=n>generate_from_frequencies</span><span class=p>(</span><span class=n>words</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>figure</span><span class=p>(</span><span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>12</span><span class=p>,</span> <span class=mi>6</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>imshow</span><span class=p>(</span><span class=n>wc</span><span class=o>.</span><span class=n>recolor</span><span class=p>(</span><span class=n>color_func</span><span class=o>=</span><span class=n>colors</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>axis</span><span class=p>(</span><span class=s1>&#39;off&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p><img src=/TexasDeathRow_files/TexasDeathRow_69_0.png alt=png></p><p>It&rsquo;s pretty clear that &rsquo;love&rsquo; is the most frequent word, by far. It&rsquo;s followed by &lsquo;know&rsquo;, &lsquo;family&rsquo;, &rsquo;thank&rsquo;, &lsquo;will&rsquo; and religious terms as &lsquo;God&rsquo;, &lsquo;Jesus&rsquo;, &lsquo;Father&rsquo;, &lsquo;Christ&rsquo;, &lsquo;Lord&rsquo;. As one could expect, people on the death row thought about family and religion, and their connection with them. Curiously, the most frequent religious terms are almost exclusively Christian (with the exception of &lsquo;God&rsquo;, maybe). There&rsquo;s also &lsquo;Allah&rsquo; but it&rsquo;s much less frequent. Let&rsquo;s check the exact frequencies of the top twenty words:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>collections</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>counts</span> <span class=o>=</span> <span class=n>collections</span><span class=o>.</span><span class=n>Counter</span><span class=p>(</span><span class=nb>dict</span><span class=p>(</span><span class=n>words</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>most_common</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>counts</span><span class=o>.</span><span class=n>most_common</span><span class=p>(</span><span class=mi>20</span><span class=p>),</span> <span class=n>columns</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;Word&#39;</span><span class=p>,</span> <span class=s1>&#39;Count&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=n>Chart</span><span class=p>(</span><span class=n>most_common</span><span class=p>)</span><span class=o>.</span><span class=n>mark_bar</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=n>X</span><span class=p>(</span><span class=s1>&#39;Word&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>scale</span><span class=o>=</span><span class=n>Scale</span><span class=p>(</span><span class=n>bandSize</span><span class=o>=</span><span class=mi>30</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=n>sort</span><span class=o>=</span><span class=n>SortField</span><span class=p>(</span><span class=s1>&#39;Count&#39;</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=</span><span class=s1>&#39;Count&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=n>Color</span><span class=p>(</span><span class=s1>&#39;Count&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>scale</span><span class=o>=</span><span class=n>Scale</span><span class=p>(</span><span class=nb>range</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;orange&#39;</span><span class=p>,</span> <span class=s1>&#39;darkred&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>                    <span class=nb>bin</span><span class=o>=</span><span class=n>Bin</span><span class=p>(</span><span class=n>maxbins</span><span class=o>=</span><span class=mi>3</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span> <span class=n>height</span><span class=o>=</span><span class=mi>350</span><span class=p>)</span>
</span></span></code></pre></div><div class=vega-embed id=6056016c-dcdd-46f4-a18b-9685ac5ddeb6></div><style>.vega-embed svg,.vega-embed canvas{border:1px dotted gray}.vega-embed .vega-actions a{margin-right:6px}</style><p><img src=/TexasDeathRow_files/TexasDeathRow_71_2.png alt=png></p><p>If it wasn&rsquo;t already clear before, the word &rsquo;love&rsquo; really is an exception: it occurs more than twice as much as the second ranking word!</p><p>From what we have seen until now, we might think that the statements can be roughly divided in two or three groups: those that focus on family, forgiveness and people in general, and those that have religious content. The third group might represent the statements in which the person quickly addresses the Warden and says they are ready or that they decline to give a statement. We&rsquo;ll check this hypothesis later when we&rsquo;ll attempt topic modeling.</p><h3 id=sentiment-analysis>Sentiment analysis</h3><p>Before moving on to the last part of the analysis, I&rsquo;ll insert a brief aside about sentiment analysis. We&rsquo;ll be using the package <code>textblob</code>, which builds stands on the shoulders of giants (the famous <code>NLTK</code> package), providing at the same time a modern API that is a pleasure to work with. The core concept in <code>textblob</code> is that of a &lsquo;blob&rsquo;, or a segment of text.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>all_sentiments</span> <span class=o>=</span> <span class=n>blobs</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=k>lambda</span> <span class=n>b</span><span class=p>:</span> <span class=n>b</span><span class=o>.</span><span class=n>sentiment</span><span class=p>)</span>
</span></span></code></pre></div><p>The <code>textblob</code> API offers two sentiment metrics:</p><ul><li>the <strong>polarity</strong> of a document is a number between <code>-1</code> (completely negative) and <code>1</code> (completely positive);</li><li>the <strong>subjectivity</strong> of a document is a number between <code>0</code> (objective language) and <code>1</code> (subjective language).</li></ul><p><code>textblob</code> offers the possibility to use NLTK&rsquo;s <code>NaiveBayesClassifier</code> to classify the polarity of each document. However, NLTK&rsquo;s classifier is trained on a movie reviews corpus, and the results weren&rsquo;t satisfactory. For this reason I opted to stay with the default implementation, which is built upon a sentiment lexicon. Each word in the lexicon has polarity and subjectivity scores, along with the intensity of each word. The total score is an aggregate of the single word scores. Although seemingly simple, the default analyzer covers quite a few special cases, including negations and intensity modifiers.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>operator</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>people_with_stmt</span> <span class=o>=</span> <span class=n>people</span><span class=o>.</span><span class=n>iloc</span><span class=p>[</span><span class=n>people</span><span class=o>.</span><span class=n>last_statement</span><span class=o>.</span><span class=n>dropna</span><span class=p>()</span><span class=o>.</span><span class=n>index</span><span class=p>]</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>people_with_stmt</span><span class=p>[</span><span class=s1>&#39;sentiment_polarity&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>s</span><span class=o>.</span><span class=n>polarity</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>all_sentiments</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>people_with_stmt</span><span class=p>[</span><span class=s1>&#39;sentiment_subjectivity&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=p>[</span><span class=n>s</span><span class=o>.</span><span class=n>subjectivity</span> <span class=k>for</span> <span class=n>s</span> <span class=ow>in</span> <span class=n>all_sentiments</span><span class=p>]</span>
</span></span></code></pre></div><p>We&rsquo;ll plot <code>polarity</code> against <code>subjectivity</code>, grouping the data by race. Why? Because usually culture and tradition correlate with race. Even thought the relation is somewhat blurry and there are a lot of other factors in play (for instance, where you grow up has considerable influence on your culture), that is the best we have.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>people_with_stmt</span><span class=p>[[</span><span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;sentiment_polarity&#39;</span><span class=p>,</span> <span class=s1>&#39;sentiment_subjectivity&#39;</span><span class=p>,</span> <span class=s1>&#39;age_execution&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=n>data</span><span class=o>.</span><span class=n>race</span> <span class=o>!=</span> <span class=s1>&#39;Other&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>show</span><span class=p>(</span><span class=n>Chart</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>mark_point</span><span class=p>()</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span><span class=o>=</span><span class=n>X</span><span class=p>(</span><span class=s1>&#39;sentiment_polarity&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>scale</span><span class=o>=</span><span class=n>Scale</span><span class=p>(</span><span class=nb>range</span><span class=o>=</span><span class=p>[</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>])),</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span><span class=o>=</span><span class=n>Y</span><span class=p>(</span><span class=s1>&#39;sentiment_subjectivity&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>scale</span><span class=o>=</span><span class=n>Scale</span><span class=p>(</span><span class=nb>range</span><span class=o>=</span><span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>])),</span>
</span></span><span class=line><span class=cl>        <span class=n>color</span><span class=o>=</span><span class=n>Color</span><span class=p>(</span><span class=s1>&#39;age_execution&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=n>scale</span><span class=o>=</span><span class=n>Scale</span><span class=p>(</span><span class=nb>range</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;yellow&#39;</span><span class=p>,</span> <span class=s1>&#39;red&#39;</span><span class=p>]),</span>
</span></span><span class=line><span class=cl>                    <span class=nb>bin</span><span class=o>=</span><span class=n>Bin</span><span class=p>(</span><span class=n>maxbins</span><span class=o>=</span><span class=mi>5</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=n>row</span><span class=o>=</span><span class=s1>&#39;race&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span> <span class=n>width</span><span class=o>=</span><span class=mi>590</span><span class=p>)</span>
</span></span></code></pre></div><div class=vega-embed id=640d6b2f-babb-461c-8c4f-53ae4c0e4b1d></div><style>.vega-embed svg,.vega-embed canvas{border:1px dotted gray}.vega-embed .vega-actions a{margin-right:6px}</style><p><img src=/TexasDeathRow_files/TexasDeathRow_78_2.png alt=png></p><p>Apart from the fact that black people are generally younger, which we had already found, it&rsquo;s quite evident that white people&rsquo;s statements have a polarity much more centered around zero, than the other two groups. Let&rsquo;s find the mean for each group:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people_with_stmt</span><span class=p>[[</span><span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;sentiment_polarity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>people_with_stmt</span><span class=p>[</span><span class=s1>&#39;race&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span></code></pre></div><div><table><thead><tr style=text-align:right><th></th><th>sentiment_polarity</th></tr><tr><th>race</th><th></th></tr></thead><tbody><tr><th>Black</th><td>0.239145</td></tr><tr><th>Hispanic</th><td>0.189329</td></tr><tr><th>Other</th><td>0.000000</td></tr><tr><th>White</th><td>0.125481</td></tr></tbody></table></div><p>As we expected from the chart, statements from black people have the highest average polarity, almost double than those from white people! Instead, the subjectivity doesn&rsquo;t appear to be a very useful metric in this case. All the charts are very centered around <code>0.5</code>, which represents middle ground between objectivity and subjectivity, and the mean doesn&rsquo;t surprise us:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>people_with_stmt</span><span class=p>[[</span><span class=s1>&#39;race&#39;</span><span class=p>,</span> <span class=s1>&#39;sentiment_subjectivity&#39;</span><span class=p>]]</span><span class=o>.</span><span class=n>groupby</span><span class=p>(</span><span class=n>people_with_stmt</span><span class=p>[</span><span class=s1>&#39;race&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>mean</span><span class=p>()</span>
</span></span></code></pre></div><div><table><thead><tr style=text-align:right><th></th><th>sentiment_subjectivity</th></tr><tr><th>race</th><th></th></tr></thead><tbody><tr><th>Black</th><td>0.522177</td></tr><tr><th>Hispanic</th><td>0.530339</td></tr><tr><th>Other</th><td>0.000000</td></tr><tr><th>White</th><td>0.487506</td></tr></tbody></table></div><h3 id=topic-modelling-with-scikit-learn>Topic modelling with <code>scikit-learn</code></h3><p>We&rsquo;ll employ LSA, or Latent Semantical Analysis, to group the statements in clusters. The statements will be vectorized with <code>TfidfVectorizer</code>, in order to obtain a matrix of frequencies. Rows represent the documents, while the columns represent unique words. Every row is normalized with respect to the Euclidean norm. The SVD algorithm is applied with the goal to reduce the number of columns (that is, of features). With fewer columns, the new matrix will have a smaller rank. The consequence of this is that some dimensions are combined and depend on more than one term. Example:</p><p>$$(\text{car}, \text{bike}, \text{bicycle}) \longrightarrow (\text{car}, \alpha_1 \times \text{bike} + \alpha_2 \times \text{bicycle})$$</p><p>It turns out that the lower-rank matrix that results from the application of the SVD algorithm can be viewed as an approximation of the original matrix, and there&rsquo;s more: this lower-rank matrix is actually the best approximation among all the other matrices with the same rank. This is extremely convenient: if one assumes that synonym words are used similarly, then the rank-lowering process should merge those terms.</p><p>Since we don&rsquo;t have labeled data, we&rsquo;ll use an unsupervised algorithm like <code>KMeans</code>, then we&rsquo;ll validate the results with the <a href=https://en.wikipedia.org/wiki/Silhouette_%28clustering%29 target=_blank rel="noopener noreferrer">silhouette method</a>. But first we have to choose how many features we want to reduce the problem to. For LSA, it&rsquo;s suggested to have around $100$ features. However, in the earlier iterations of this project, I found that leaving that many features gave very poor results. After some experimentation, I settled on $20$, knowing that it&rsquo;s particularly low.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.pipeline</span> <span class=kn>import</span> <span class=n>make_pipeline</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.preprocessing</span> <span class=kn>import</span> <span class=n>Normalizer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.decomposition</span> <span class=kn>import</span> <span class=n>TruncatedSVD</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.feature_extraction.text</span> <span class=kn>import</span> <span class=n>TfidfVectorizer</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>vectorizer</span> <span class=o>=</span> <span class=n>TfidfVectorizer</span><span class=p>(</span><span class=n>stop_words</span><span class=o>=</span><span class=s1>&#39;english&#39;</span><span class=p>,</span> <span class=n>sublinear_tf</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>use_idf</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>svd</span> <span class=o>=</span> <span class=n>TruncatedSVD</span><span class=p>(</span><span class=n>n_components</span><span class=o>=</span><span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pipe</span> <span class=o>=</span> <span class=n>make_pipeline</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>vectorizer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>svd</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>Normalizer</span><span class=p>(</span><span class=n>copy</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>X_s</span> <span class=o>=</span> <span class=n>pipe</span><span class=o>.</span><span class=n>fit_transform</span><span class=p>(</span><span class=n>people_with_stmt</span><span class=o>.</span><span class=n>last_statement</span><span class=p>)</span>
</span></span></code></pre></div><p>As expected, the shape of the resulting matrix is $(n_{\text{statements}},\;n_{\text{components}})$:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>X_s</span><span class=o>.</span><span class=n>shape</span>
</span></span></code></pre></div><pre><code>(436, 20)
</code></pre><p>We have now the possibility to check the hypothesis we formulated earlier: the idea was that the statements are roughly divided into three groups:</p><ul><li>the short statements of the people refusing to talk or those saying to the Warden that they were ready;</li><li>the statements which addressed the immediate family;</li><li>the statements with heavy religious content.</li></ul><p>Let&rsquo;s check this hypothesis. We&rsquo;ll now try different values for the number of
clusters (from $2$ to $7$) and visualize the silhouette score of each
result.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.cm</span> <span class=k>as</span> <span class=nn>cm</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.cluster</span> <span class=kn>import</span> <span class=n>KMeans</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sklearn.metrics</span> <span class=kn>import</span> <span class=n>silhouette_score</span><span class=p>,</span> <span class=n>silhouette_samples</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=p>,</span> <span class=n>axes</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>figsize</span><span class=o>=</span><span class=p>(</span><span class=mi>7</span><span class=p>,</span> <span class=mi>10</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>n_clusters</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=mi>8</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span> <span class=o>=</span> <span class=n>axes</span><span class=p>[</span><span class=n>n_clusters</span> <span class=o>//</span> <span class=mi>2</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>n_clusters</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>set_xlim</span><span class=p>([</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.5</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=c1># The (n_clusters+1)*10 is for inserting blank space between silhouette</span>
</span></span><span class=line><span class=cl>    <span class=c1># plots of individual clusters, to demarcate them clearly.</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>set_ylim</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>X_s</span><span class=p>)</span> <span class=o>+</span> <span class=p>(</span><span class=n>n_clusters</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>clusterer</span> <span class=o>=</span> <span class=n>KMeans</span><span class=p>(</span><span class=n>n_clusters</span><span class=o>=</span><span class=n>n_clusters</span><span class=p>,</span> <span class=n>random_state</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>max_iter</span><span class=o>=</span><span class=mi>10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cluster_labels</span> <span class=o>=</span> <span class=n>clusterer</span><span class=o>.</span><span class=n>fit_predict</span><span class=p>(</span><span class=n>X_s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>silhouette_avg</span> <span class=o>=</span> <span class=n>silhouette_score</span><span class=p>(</span><span class=n>X_s</span><span class=p>,</span> <span class=n>cluster_labels</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Compute the silhouette scores for each sample</span>
</span></span><span class=line><span class=cl>    <span class=n>sample_silhouette_values</span> <span class=o>=</span> <span class=n>silhouette_samples</span><span class=p>(</span><span class=n>X_s</span><span class=p>,</span> <span class=n>cluster_labels</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>y_lower</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_clusters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># Aggregate the silhouette scores for samples belonging to</span>
</span></span><span class=line><span class=cl>        <span class=c1># cluster i, and sort them</span>
</span></span><span class=line><span class=cl>        <span class=n>ith_silhouette</span> <span class=o>=</span> <span class=n>sample_silhouette_values</span><span class=p>[</span><span class=n>cluster_labels</span> <span class=o>==</span> <span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>ith_silhouette</span><span class=o>.</span><span class=n>sort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>size_cluster_i</span> <span class=o>=</span> <span class=n>ith_silhouette</span><span class=o>.</span><span class=n>shape</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>y_upper</span> <span class=o>=</span> <span class=n>y_lower</span> <span class=o>+</span> <span class=n>size_cluster_i</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>color</span> <span class=o>=</span> <span class=n>cm</span><span class=o>.</span><span class=n>rainbow</span><span class=p>(</span><span class=n>i</span> <span class=o>/</span> <span class=n>n_clusters</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ax</span><span class=o>.</span><span class=n>fill_betweenx</span><span class=p>(</span><span class=n>np</span><span class=o>.</span><span class=n>arange</span><span class=p>(</span><span class=n>y_lower</span><span class=p>,</span> <span class=n>y_upper</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                         <span class=mi>0</span><span class=p>,</span> <span class=n>ith_silhouette</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                         <span class=n>facecolor</span><span class=o>=</span><span class=n>color</span><span class=p>,</span> <span class=n>edgecolor</span><span class=o>=</span><span class=n>color</span><span class=p>,</span> <span class=n>alpha</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Label the silhouette plots with their cluster numbers at the middle</span>
</span></span><span class=line><span class=cl>        <span class=n>ax</span><span class=o>.</span><span class=n>text</span><span class=p>(</span><span class=o>-</span><span class=mf>0.05</span><span class=p>,</span> <span class=n>y_lower</span> <span class=o>+</span> <span class=mf>0.5</span> <span class=o>*</span> <span class=n>size_cluster_i</span><span class=p>,</span> <span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Compute the new y_lower for next plot</span>
</span></span><span class=line><span class=cl>        <span class=n>y_lower</span> <span class=o>=</span> <span class=n>y_upper</span> <span class=o>+</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Silhouette coefficient (avg. </span><span class=si>{:.3f}</span><span class=s1>)&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>silhouette_avg</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;Cluster label&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>axvline</span><span class=p>(</span><span class=n>x</span><span class=o>=</span><span class=n>silhouette_avg</span><span class=p>,</span> <span class=n>color</span><span class=o>=</span><span class=s1>&#39;red&#39;</span><span class=p>,</span> <span class=n>linestyle</span><span class=o>=</span><span class=s1>&#39;--&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>set_yticks</span><span class=p>([])</span>
</span></span><span class=line><span class=cl>    <span class=n>ax</span><span class=o>.</span><span class=n>set_xticks</span><span class=p>([</span><span class=o>-</span><span class=mf>0.1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.4</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>fig</span><span class=o>.</span><span class=n>tight_layout</span><span class=p>(</span><span class=n>h_pad</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>(</span><span class=n>fig</span><span class=p>)</span>
</span></span></code></pre></div><p><img src=/TexasDeathRow_files/TexasDeathRow_88_0.png alt=png></p><p>The vertical axis in each subplot represents the statements, grouped by cluster label and sorted within each cluster by their silhouette score. The silhouette score of an element ranges between $-1$ and $1$, where a value of $-1$ means that the element is in the wrong cluster, while $1$ indicates that it&rsquo;s perfectly clustered.</p><p>By comparing each cluster with the average silhouette score we can immediately discard some candidates: with two, three or even four clusters the result is unsatisfactory, since there are clusters almost completely below the average score. Not to mention the negative scores. Among the remaining ones, we choose the one with the fewest negative scores, and that appears to be the one with six clusters, which also has the highest average score.</p><p>Let&rsquo;s see what are the most important words for each cluster.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_topics</span><span class=p>(</span><span class=n>n_clusters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>km</span> <span class=o>=</span> <span class=n>KMeans</span><span class=p>(</span><span class=n>n_clusters</span><span class=o>=</span><span class=n>n_clusters</span><span class=p>,</span> <span class=n>max_iter</span><span class=o>=</span><span class=mi>10000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>km</span><span class=o>.</span><span class=n>fit</span><span class=p>(</span><span class=n>X_s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>original_space_centroids</span> <span class=o>=</span> <span class=n>svd</span><span class=o>.</span><span class=n>inverse_transform</span><span class=p>(</span><span class=n>km</span><span class=o>.</span><span class=n>cluster_centers_</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>order_centroids</span> <span class=o>=</span> <span class=n>original_space_centroids</span><span class=o>.</span><span class=n>argsort</span><span class=p>()[:,</span> <span class=p>::</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>terms</span> <span class=o>=</span> <span class=n>vectorizer</span><span class=o>.</span><span class=n>get_feature_names</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>clusters</span> <span class=o>=</span> <span class=p>[[</span><span class=n>terms</span><span class=p>[</span><span class=n>ind</span><span class=p>]</span> <span class=k>for</span> <span class=n>ind</span> <span class=ow>in</span> <span class=n>order_centroids</span><span class=p>[</span><span class=n>i</span><span class=p>,</span> <span class=p>:</span><span class=mi>8</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_clusters</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>n_clusters</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;</span><span class=si>{}</span><span class=s1>) </span><span class=si>{}</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>clusters</span><span class=p>[</span><span class=n>i</span><span class=p>])))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>print_topics</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>0) lord jesus amen god praise thank christ home
1) know say did want don just love innocent
2) love thank tell family like friends want warden
3) warden ready statement declined offender make let say
4) ll ya love tell going family everybody kids
5) sorry family hope forgive peace love like pain
</code></pre><p>We can recognize the clusters I was talking about before: there&rsquo;s a cluster with religious statements, and another one which represents all the shorter statements. The other ones are not as clear. Some mention the word &lsquo;family&rsquo;, but not other key words like &lsquo;kids&rsquo; or &lsquo;wife&rsquo;. There&rsquo;s clearly some overlap between the clusters, and that reinforces the idea that our hypothesis might be more accurate. We may be tempted to disregard the silhouette analysis and proceed with three clusters, but we&rsquo;ll be met with disappointment:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>print_topics</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></div><pre><code>0) love ll tell thank ya strong want family
1) warden statement ready know did say want let
2) sorry family love forgive hope like god thank
</code></pre><p>The topics are not at all like we envisioned, and there&rsquo;s too much overlap. It appears that six clusters is indeed a better model.</p><h4 id=other-scikit-learn-models>Other <code>scikit-learn</code> models</h4><p>I also tried to fit a <code>MeanShift</code> model and a <code>DBSCAN</code> model. Unfortunately, the results weren&rsquo;t acceptable: the first one was either finding ten (or more) clusters or just one. The latter yielded slightly better results (at first sight), finding three clusters, but that was misleading: $97%$ of the data was classified in the same cluster. For these reasons I dropped them and I won&rsquo;t show the code here, although it&rsquo;s very similar to what we have just done with <code>KMeans</code> (the <code>scikit-learn</code> API is amazingly consistent).</p><h3 id=topic-modelling-with-gensim>Topic modelling with <code>gensim</code></h3><p>Finally, I wanted to try out <code>gensim</code>, which is a package built specifically for topic modeling. The first thing to do is tokenization.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gensim.utils</span> <span class=kn>import</span> <span class=n>smart_open</span><span class=p>,</span> <span class=n>simple_preprocess</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gensim.parsing.preprocessing</span> <span class=kn>import</span> <span class=n>STOPWORDS</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>tokenize</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>token</span> <span class=k>for</span> <span class=n>token</span> <span class=ow>in</span> <span class=n>simple_preprocess</span><span class=p>(</span><span class=n>text</span><span class=p>)</span> <span class=k>if</span> <span class=n>token</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>STOPWORDS</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tokens</span> <span class=o>=</span> <span class=n>people_with_stmt</span><span class=o>.</span><span class=n>last_statement</span><span class=o>.</span><span class=n>map</span><span class=p>(</span><span class=n>tokenize</span><span class=p>)</span><span class=o>.</span><span class=n>values</span>
</span></span></code></pre></div><p>Then we have to create a <code>Dictionary</code>, which contains all the unique words and provides the method <code>doc2bow</code> to convert a document to its bag-of-words representation: a list of tuples <code>(word_id, word_frequency)</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gensim.corpora</span> <span class=kn>import</span> <span class=n>Dictionary</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dictionary</span> <span class=o>=</span> <span class=n>Dictionary</span><span class=p>(</span><span class=n>tokens</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>corpus</span> <span class=o>=</span> <span class=p>[</span><span class=n>dictionary</span><span class=o>.</span><span class=n>doc2bow</span><span class=p>(</span><span class=n>t</span><span class=p>)</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>tokens</span><span class=p>]</span>
</span></span></code></pre></div><p>We can now build an LSI model, which stands for Latent Semantic Indexing and is equivalent to LSA, which we used before. We&rsquo;ll build the model with three clusters.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gensim.models</span> <span class=kn>import</span> <span class=n>TfidfModel</span><span class=p>,</span> <span class=n>LsiModel</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tfidf_model</span> <span class=o>=</span> <span class=n>TfidfModel</span><span class=p>(</span><span class=n>corpus</span><span class=p>,</span> <span class=n>id2word</span><span class=o>=</span><span class=n>dictionary</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lsi_model</span> <span class=o>=</span> <span class=n>LsiModel</span><span class=p>(</span><span class=n>tfidf_model</span><span class=p>[</span><span class=n>corpus</span><span class=p>],</span> <span class=n>id2word</span><span class=o>=</span><span class=n>dictionary</span><span class=p>,</span> <span class=n>num_topics</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>[(</span><span class=n>label</span><span class=p>,</span> <span class=p>[</span><span class=n>word</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>words</span><span class=p>])</span>
</span></span><span class=line><span class=cl> <span class=k>for</span> <span class=n>label</span><span class=p>,</span> <span class=n>words</span> <span class=ow>in</span> <span class=n>lsi_model</span><span class=o>.</span><span class=n>show_topics</span><span class=p>(</span><span class=n>num_words</span><span class=o>=</span><span class=mi>7</span><span class=p>,</span> <span class=n>formatted</span><span class=o>=</span><span class=kc>False</span><span class=p>)]</span>
</span></span></code></pre></div><pre><code>[(0, ['ll', 'love', 'thank', 'ya', 'sorry', 'family', 'ready']),
 (1, ['ll', 'ya', 'tell', 'peace', 'kids', 'miss', 'lord']),
 (2,
  ['statement', 'declined', 'offender', 'ready', 'warden', 'final', 'ahead'])]
</code></pre><p>The result is quite different from what we got from <code>KMeans</code>. Here, the clusters are slightly better defined: one for shorter statements directed to the Warden, one for the family and lastly one with mixed words (even from a religious lexicon).</p><h2 id=wrapping-up>Wrapping up</h2><p>We analyzed a very interesting dataset, and even though it was fairly small in size, it provided us with quite a number of thought-provoking insights that could be the starting point for further analysis. The goal of this exploration wasn&rsquo;t to reach a definitive conclusion about the dataset, but rather to put together different aspects of data analysis and visualization. This was also an opportunity to acquaint myself with various Python libraries.</p></article></main><div id=replybox class=comments></div><script>window.replybox={site:"W3RG8mGY7K"}</script><script src=https://cdn.getreplybox.com/js/embed.js defer></script><footer role=contentinfo><div class=hr></div><div class=footer-links><ul><li><script>document.write("<a href='mai&#108;to&#58;&#109;ich&#101;&#108;%65l%"+"6"+"1"+"c"+"c"+"%"+"6"+"8"+"i"+"a"+"%"+"&"+"#"+"5"+"2"+";"+"0"+"%"+"6"+"&"+"#"+"5"+"5"+";"+"&"+"#"+"1"+"0"+"9"+";"+"&"+"#"+"9"+"7"+";"+"&"+"#"+"1"+"0"+"5"+";"+"l"+"%"+"&"+"#"+"5"+"0"+";"+"E"+"%"+"6"+"3"+"o"+"m"+"'"+">"+"E"+"m"+"a"+"i"+"&"+"#"+"1"+"0"+"8"+";"+"<"+"/"+"a"+">")</script></li><li><a href=https://github.com/rubik/ target=_blank rel=noopener>GitHub</a></li><li><a href=https://www.linkedin.com/in/michele-lacchia/ target=_blank rel=noopener>LinkedIn</a></li><li><a href=/page/about/>About me</a></li><li><a href=http://feeds.feedburner.com/signal-to-noise>RSS</a></li></ul></div><div class=copyright>Created by Michele Lacchia, built with Hugo</div></footer></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css integrity=sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.js integrity=sha384-Qsn9KnoKISj6dI8g7p1HBlNpVx0I8p1SvlwOldgi3IorMle61nQy4zEahWYtljaz crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.querySelector(".container main"),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script><script defer src=//instant.page/5.1.1 type=module integrity=sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq></script></body></html>