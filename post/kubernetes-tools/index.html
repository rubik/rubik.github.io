<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/static/icons/apple-touch-icon.png><link rel=icon type=image/png href=/static/icons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/static/icons/favicon-16x16.png sizes=16x16><link rel=manifest href=/static/icons/manifest.json><link rel=mask-icon href=/static/icons/safari-pinned-tab.svg color=#2ae2b1><link rel="shortcut icon" href=/static/icons/favicon.ico><meta name=msapplication-config content="/static/icons/browserconfig.xml"><meta name=theme-color content="#ffffff"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400&display=swap" rel=stylesheet><link rel=stylesheet href=https://signal-to-noise.xyz/scss/main.min.6d905468f4703eed3a6be770925feacadfbddf831f38d2d000062749b1b4e74a.css integrity="sha256-bZBUaPRwPu06a+dwkl/qyt+934MfONLQAAYnSbG050o="><script async src=https://rum.cronitor.io/script.js></script>
<script>window.cronitor=window.cronitor||function(){(window.cronitor.q=window.cronitor.q||[]).push(arguments)},cronitor("config",{clientKey:"ab51f29e7df6ffe65a02338fc78976e1"})</script><title>Kubernetes tools and plugins for enhanced productivity</title><meta name=description content="A list of useful Kubernetes tools for enhanced productivity."><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/signal-to-noise.xyz\/post\/kubernetes-tools\/"},"headline":"Kubernetes tools and plugins for enhanced productivity","name":"Kubernetes tools and plugins for enhanced productivity","datePublished":"2020-06-07","dateModified":"20200607-00:00:00.000","author":{"@type":"Person","name":"Michele Lacchia"},"publisher":{"@type":"Organization","name":"Signal to Noise","logo":{"@type":"ImageObject","url":"https:\/\/signal-to-noise.xyz\/static\/images\/signal-to-noise.png"}},"description":"A list of useful Kubernetes tools for enhanced productivity.","keywords":"kubernetes,containers,big-list"}</script></head><body><div class=container><header role=banner><div class=header-logo><a href=/><img src=/static/images/signal-to-noise.png width=60 height=60 alt="Signal to Noise"></a></div></header><main role=main><article class=main-content><div class=post-meta><h1>Kubernetes tools and plugins for enhanced productivity</h1><span><time datetime=2020-06-07>June 07, 2020</time>, Michele Lacchia</span></div><div class=post-tags><a href=https://signal-to-noise.xyz//tags/kubernetes>kubernetes</a>
<a href=https://signal-to-noise.xyz//tags/containers>containers</a>
<a href=https://signal-to-noise.xyz//tags/big-list>big-list</a></div><figure><img itemprop=image title="A pipeline" src=/static/images/port-containers.jpg><div class=copyright>Photo by&nbsp;<a href="https://unsplash.com/@timelabpro?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Timelab Pro</a>&nbsp;on&nbsp;<a href="https://unsplash.com/s/photos/port-containers?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>.</div></figure><p><code>kubectl</code> is a great tool, but when the clusters start to multiply and each one
has several namespaces, staying productive can become a challenge. In this
short post I present some tools that I consider very useful when managing
Kubernetes clusters. The first three (kubectx, kubens, stern) are absolutely
essential, and I could not do without them anymore.</p><h3 id=kubectx-and-kubens>kubectx and kubens</h3><p>If you have multiple clusters, you can switch between them using the command</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ kubectl config use-context &lt;name&gt;
</span></span></code></pre></div><p>This procedure quickly becomes annoying when you start managing many different
clusters or the context names are not short. E.g. in GKE, the default context
name has the form <code>gke_&lt;project id>_&lt;region>-&lt;zone>_&lt;cluster name></code>.</p><p>The <a href=https://github.com/ahmetb/kubectx target=_blank rel="noopener noreferrer"><code>kubectx</code></a> command allows you to
accomplish this task and related ones much more quickly and efficiently:</p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Explanation</th></tr></thead><tbody><tr><td style=text-align:left><code>kubectx &lt;name></code></td><td style=text-align:left>switch to the context <code>&lt;name></code></td></tr><tr><td style=text-align:left><code>kubectx -</code></td><td style=text-align:left>switch to the previous context</td></tr><tr><td style=text-align:left><code>kubectx &lt;new>=&lt;old></code></td><td style=text-align:left>rename <code>&lt;old></code> to <code>&lt;new></code></td></tr><tr><td style=text-align:left><code>kubectx &lt;new>=.</code></td><td style=text-align:left>rename the current context to <code>&lt;new></code></td></tr></tbody></table><p>If you install <a href=https://github.com/junegunn/fzf target=_blank rel="noopener noreferrer"><code>fzf</code></a>, kubectx becomes
interactive:</p><img src=/static/images/kubectx-interactive.gif style=margin-bottom:2em><p>The companion command <a href=https://github.com/ahmetb/kubectx target=_blank rel="noopener noreferrer"><code>kubens</code></a>, allows you
to switch between namespaces:</p><table><thead><tr><th style=text-align:left>Command</th><th style=text-align:left>Explanation</th></tr></thead><tbody><tr><td style=text-align:left><code>kubens &lt;name></code></td><td style=text-align:left>switch to the namespace <code>&lt;name></code></td></tr><tr><td style=text-align:left><code>kubens -</code></td><td style=text-align:left>switch to the previous namespace</td></tr><tr><td style=text-align:left><code>kubens -c</code></td><td style=text-align:left>show the current namespace</td></tr></tbody></table><p>With <code>fzf</code>, kubens becomes interactive too. Both tools also support tab
completion.</p><h3 id=stern>stern</h3><p>The built-in command to tail logs, <code>kubectl logs</code>, has two significant
limitations:</p><ol><li>it can only tail logs from one Pod at a time, and the Pod name has to be
specified exactly â€” this is inconvenient when applications are
deployed with multiple replicas; the Pod name will also change every time
it&rsquo;s recreated.</li><li>If multiple containers are present within a Pod, the container name has to
be specified exactly. It&rsquo;s not possible to tail logs from multiple
containers at the same time.</li></ol><p>To work around those limitations, <a href=https://github.com/wercker/stern target=_blank rel="noopener noreferrer"><code>stern</code></a>
was created. It makes log-tailing a breeze, allowing to tail logs from multiple
containers and Pods at the same time. Pods and containers are included and
excluded with regular expressions, and that makes stern incredibly flexible. It
can even filter on the message timestamps and output in several different
formats.</p><table><thead><tr><th>Command</th><th>Explanation</th></tr></thead><tbody><tr><td><code>stern "web-\w"</code></td><td>tail logs from all containers in Pods matching the <code>web-\w</code> regex</td></tr><tr><td><code>stern web -c nginx</code></td><td>tail logs from the <code>nginx</code> container in Pods matching the &ldquo;web&rdquo; query</td></tr><tr><td><code>stern -s 15min backend</code></td><td>tail logs newer than a relative duration like &ldquo;2m&rdquo; or &ldquo;3h&rdquo;</td></tr><tr><td><code>stern --tail 10 backend</code></td><td>show at most 10 lines from the backend Pods</td></tr><tr><td><code>stern --all-namespaces -l app=nginx</code></td><td>tail Pods from all namespaces matching the label selector <code>app=nginx</code></td></tr><tr><td><code>stern web -o json</code></td><td>output logs in JSON format</td></tr></tbody></table><h3 id=polaris>Polaris</h3><p><a href=https://github.com/FairwindsOps/polaris target=_blank rel="noopener noreferrer">Polaris</a> is a static analysis tool
that ensures that a variety of best practices are respected. Notably, it also
includes a <a href=https://github.com/FairwindsOps/polaris#webhook target=_blank rel="noopener noreferrer">validating
webhook</a> that can be installed
in your cluster to automatically check all workloads and reject those that
don&rsquo;t adhere to your policies.</p><h3 id=popeye>Popeye</h3><p><a href=https://github.com/derailed/popeye target=_blank rel="noopener noreferrer">Popeye</a> scans your cluster for best
practices and potential issues. It aims to detect misconfigurations, like port
mismatches, dead or unused resources, metrics utilization, probes, container
images, RBAC rules, naked resources, etc. It should be noted that it&rsquo;s not a
static analysis tool, as it actually inspects the live cluster. For that
reason, the user running Popeye must have enough RBAC privileges to get/list
the resources that Popeye checks. Overall, Popeye is a good complement to
Polaris.</p><h3 id=krew>krew</h3><p><a href=https://github.com/kubernetes-sigs/krew target=_blank rel="noopener noreferrer"><code>krew</code></a> is a plugin manager for
kubectl. As of the date of this post, there are more than <a href=https://github.com/kubernetes-sigs/krew-index/blob/master/plugins.md target=_blank rel="noopener noreferrer">70
plugins</a>
available through krew. Many of the tool mentioned in this post are also
installable with krew. Installing new plugins is very easy and straightforward.</p><h3 id=rbac-manager-and-rbac-lookup>RBAC manager and rbac-lookup</h3><p>When RBAC policies start to become unmanageable, a tool like <a href=https://github.com/FairwindsOps/rbac-manager target=_blank rel="noopener noreferrer">RBAC
Manager</a> becomes essential. The
RBAC Manager operator introduces new custom resources that allow a declarative
management style of RBAC policies. Instead of managing role bindings directly,
one can specify the desired RBAC state and the operator will take the necessary
actions to achieve that state.</p><p><a href=https://github.com/FairwindsOps/rbac-manager#an-example target=_blank rel="noopener noreferrer">The example</a> in the
README is clearer than any explanation. Suppose that we want to grant our user
Joe <code>edit</code> access to the <code>web</code> namespace and <code>view</code> access to <code>api</code> namespace.
With RBAC, that requires creating two role bindings. The first grants <code>edit</code>
access to the <code>web</code> namespace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>joe-web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>User</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>joe@example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>edit</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span></code></pre></div><p>The second grants <code>view</code> access to the <code>api</code> namespace:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RoleBinding</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>joe-api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>User</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>joe@example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>roleRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ClusterRole</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>view</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>apiGroup</span><span class=p>:</span><span class=w> </span><span class=l>rbac.authorization.k8s.io</span><span class=w>
</span></span></span></code></pre></div><p>One can easily see how this approach can quickly grow out of control with many
users and many namespaces. With RBAC Manager, one can use a single custom
resource to achieve the same result:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>rbacmanager.reactiveops.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>RBACDefinition</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>joe-access</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>rbacBindings</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>joe</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>subjects</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>User</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>joe@example.com</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>roleBindings</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>api</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>clusterRole</span><span class=p>:</span><span class=w> </span><span class=l>view</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>clusterRole</span><span class=p>:</span><span class=w> </span><span class=l>edit</span><span class=w>
</span></span></span></code></pre></div><p>The companion tool <a href=https://github.com/FairwindsOps/rbac-lookup target=_blank rel="noopener noreferrer"><code>rbac-lookup</code></a>
is very useful to inspect roles bound to any user or service account. When run
on GKE clusters, it can also show IAM roles.</p></article></main><div id=replybox class=comments></div><script>window.replybox={site:"W3RG8mGY7K"}</script><script src=https://cdn.getreplybox.com/js/embed.js defer></script><footer role=contentinfo><div class=hr></div><div class=footer-links><ul><li><script>document.write("<a href='mai&#108;to&#58;&#109;ich&#101;&#108;%65l%"+"6"+"1"+"c"+"c"+"%"+"6"+"8"+"i"+"a"+"%"+"&"+"#"+"5"+"2"+";"+"0"+"%"+"6"+"&"+"#"+"5"+"5"+";"+"&"+"#"+"1"+"0"+"9"+";"+"&"+"#"+"9"+"7"+";"+"&"+"#"+"1"+"0"+"5"+";"+"l"+"%"+"&"+"#"+"5"+"0"+";"+"E"+"%"+"6"+"3"+"o"+"m"+"'"+">"+"E"+"m"+"a"+"i"+"&"+"#"+"1"+"0"+"8"+";"+"<"+"/"+"a"+">")</script></li><li><a href=https://github.com/rubik/ target=_blank rel=noopener>GitHub</a></li><li><a href=https://www.linkedin.com/in/michele-lacchia/ target=_blank rel=noopener>LinkedIn</a></li><li><a href=/page/about/>About me</a></li><li><a href=http://feeds.feedburner.com/signal-to-noise>RSS</a></li></ul></div><div class=copyright>Created by Michele Lacchia, built with Hugo</div></footer></div><script defer src=//instant.page/5.1.1 type=module integrity=sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq></script></body></html>